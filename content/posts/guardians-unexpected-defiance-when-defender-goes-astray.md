---
title: "Guardian's Unexpected Defiance: When Defender Goes Astray"
date: 2023-10-17T21:36:38"
draft: false
tags: []
---

<p>In the ever-evolving world of cybersecurity, there's a constant tug-of-war between defenders and hackers. As experts work hard to secure systems, attackers are always on the lookout for a weak spot. But what happens when the line blurs? Interestingly, I stumbled upon a situation where Windows Defender, Microsoft's own security tool, seemed to be its own worst enemy.</p><h2 id="prologue-setting-the-stage-for-a-security-puzzle">Prologue: Setting the Stage for a Security Puzzle</h2><p>To provide context, I delved into a peculiar issue where several Windows devices sporadically showed as non-compliant due to the real-time protection appearing as deactivated. At first glance, it seemed like an isolated device problem. However, a deeper probe revealed a captivating turn of events: the Defender seemed to be sabotaging itself. In this account, I've structured the entire investigation as a series of unfolding scenes.</p><h3 id="act-i-unraveling-the-threads-of-suspicious-activity">Act I: Unraveling the Threads of Suspicious Activity</h3><p>Our story starts with a chain of unassuming incidents, each softly suggesting a hidden irregularity. Diving into the security logs, these events hint at possible meddling with the core operations of Windows Defender.</p><p><strong>Scene 1: Tamper Protection Disabled – A Breach in the Defense</strong></p><p>The initial scene of this captivating drama reveals a seemingly benign occurrence, <strong>Event ID 1121</strong>, indicating the deactivation of Tamper Protection, an essential security feature to prevent unauthorized changes to security settings. </p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2023/10/unnamed.png" class="kg-image" alt="" loading="lazy" width="1128" height="1042" srcset="__GHOST_URL__/content/images/size/w600/2023/10/unnamed.png 600w, __GHOST_URL__/content/images/size/w1000/2023/10/unnamed.png 1000w, __GHOST_URL__/content/images/2023/10/unnamed.png 1128w" sizes="(min-width: 720px) 720px"></figure><p>What's strange is that the "<strong>SecurityHealthService</strong>" process, which usually just watches and reports on security, was behind this change. This isn't normal and raised more suspicion.</p><p>To determine what transpired, I began examining other actions taken by the SecurityHealthService process, such as initiating new tasks or altering system settings. As I delved deeper into this information, it became increasingly intriguing to uncover what went wrong, who or what caused the security feature to deactivate, and whether there were additional security concerns to address.</p><p><strong>Scene 2: Real-time Monitoring Under Siege – A Compromised Watchtower</strong></p><p>Event ID 1116 unveils a troubling change to the "<strong>DisableRealtimeMonitoring</strong>" registry value. Surprisingly, the responsible party is MsSense.exe, a trusted Windows Defender process, which appears to be acting contrary to its usual function.</p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2023/10/image-2.png" class="kg-image" alt="" loading="lazy" width="1066" height="1058" srcset="__GHOST_URL__/content/images/size/w600/2023/10/image-2.png 600w, __GHOST_URL__/content/images/size/w1000/2023/10/image-2.png 1000w, __GHOST_URL__/content/images/2023/10/image-2.png 1066w" sizes="(min-width: 720px) 720px"></figure><p>This registry value controls whether real-time monitoring is enabled or disabled for Windows Defender. The event details mention that the "MsSense.exe" process modified the "DisableRealtimeMonitoring" registry value. This is concerning because MsSense.exe is a Windows Defender process, but it should not be modifying registry values related to real-time monitoring. This could be a sign of malware hijacking the MsSense.exe process or a misconfiguration issue in policy. </p><p>To further investigate this event, I proceeded with checking for other events related to the MsSense.exe process, such as process creation or other registry modifications and surprisingly the device timeline was filled with these events!</p><p><strong>Scene 3: Registry Tampering – A Veiled Manipulation</strong></p><p>The concluding chapter of this puzzling saga reveals Event ID 1, a general yet foreboding sign of registry alteration. The exact registry value being modified is again related to Windows Defender's security protocols. The well-known entity of mssense.exe, once again a trusted process, emerges once more as the mastermind behind this secretive adjustment.</p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2023/10/unnamed-3.png" class="kg-image" alt="" loading="lazy" width="1022" height="759" srcset="__GHOST_URL__/content/images/size/w600/2023/10/unnamed-3.png 600w, __GHOST_URL__/content/images/size/w1000/2023/10/unnamed-3.png 1000w, __GHOST_URL__/content/images/2023/10/unnamed-3.png 1022w" sizes="(min-width: 720px) 720px"></figure><hr><p><strong>Piecing Together the Puzzle – A Quest for Understanding</strong></p><p>Within our unfolding narrative, the self-removal of the Real-time Protection service by Windows Defender is a startling twist. This unusual event points to two possibilities: the system may have fallen prey to malicious software manipulating Windows Defender, or there's a critical flaw within the security software.</p><p>Without the shield of real-time protection, the system stands exposed to various digital menaces, from viruses to ransomware. Without this safeguard, malicious entities can easily slip past defenses, threatening the system's data and overall well-being.</p><p>It's alarming to see a genuine Windows Defender process, TiWorker.exe, removing a file seemingly connected to securityhealthhost.exe, another Windows Defender component. This could indicate malware manipulating the TiWorker.exe process to erase security-related files, or it might be a system misconfiguration.</p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2023/10/image-3.png" class="kg-image" alt="" loading="lazy" width="982" height="1428" srcset="__GHOST_URL__/content/images/size/w600/2023/10/image-3.png 600w, __GHOST_URL__/content/images/2023/10/image-3.png 982w" sizes="(min-width: 720px) 720px"></figure><p>Diving further sheds more light on the intricate process tree from Process Hacker, honing in on the MsMpEng.exe process and its descendants. Amidst the puzzling series of events, the provided screenshot further brings to light intriguing activity from Microsoft Defender. As per the details:</p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2023/10/unnamed-9.png" class="kg-image" alt="" loading="lazy" width="978" height="1112" srcset="__GHOST_URL__/content/images/size/w600/2023/10/unnamed-9.png 600w, __GHOST_URL__/content/images/2023/10/unnamed-9.png 978w" sizes="(min-width: 720px) 720px"></figure><ul><li><strong>services.exe</strong> and <strong>svchost.exe</strong>: Both these processes, foundational elements of the Windows operating system, were seen operating as expected. Their typical roles involve managing various services and hosting multiple Windows services, respectively. Notably, no suspicious activity was detected for these two processes.</li><li><strong>TiWorker.exe</strong>: Things take an unexpected turn with this process. TiWorker.exe, typically involved with Windows updates, had been invoked with a specific command. Its interaction or possible deletion of files associated with security health services raises eyebrows. Specifically, a file tied to security health services seems to have been targeted, as evidenced by the path suggesting a link with <code>securityhealthservice.exe</code>.</li></ul><hr><h2 id="the-search-continues">The Search Continues:</h2><p>It's really odd what's happening with Microsoft Defender. This program, built to keep our computers safe, is acting out of character. Instead of guarding our computer, Defender is, in a way, shooting itself in the foot by messing with its own important security parts. Imagine if a security guard, instead of watching the entrance, started locking people inside. That's how weird this is! Now, the big question is: "<strong>Why is this happening?</strong>", "<strong>Is Defender attacking itself?</strong>.</p><p>We don't have all the answers yet, but the good news is that Defender Product team is aware of this situation. They've got their best folks trying to understand the reason behind Defender's strange actions. As they work on this mystery, I am eager to hear their findings and what steps might be taken next and I will keep you posted!</p>