---
title: "The "allow_pairing" Caper: How a Tiny Setting Sent Me on a Wild Goose Chase"
date: 2024-02-14T13:49:52"
draft: false
tags: []
---

<p>Just a few months ago, we rolled out the shiny new iOS 17 and macOS Sonoma to our excited user base. As seasoned MDM admins, our pre-release ritual involved meticulously combing through Apple Seed and Microsoft documentation for potential service disruptions or security concerns. Everything seemed smooth sailing, and after passing our rigorous testing, both OS updates arrived at their production destinations.</p><p>But then, amidst the celebratory sighs, a storm cloud brewed: connecting managed iPhones to corporate Macs suddenly became a pain point. Our security policy? Only allowing corporate iOS devices to sync with specially managed Macs using Apple Configurator Certificates. This meant Macs needed a local copy of the trusted certificate to authorize the pairing – no certificate, no connection. Uh oh. But the certificates were installed &amp; trusted. So what could have gone wrong? Was it Sonoma, iOS 17 or Xcode? </p><p>Get ready to delve into the world of Apple complexities, unexpected updates, and the quest for seamless iPhone-Mac connections. </p><p><strong>Spoiler alert:</strong> Not only did I crack the case, but I also emerged with some key takeaways for fellow admins! Get ready for a dive into the trenches of MDM troubleshooting – let's do this!</p><h3 id="lets-start-with-basics-first"><strong>Let's Start With Basics First</strong></h3><p>Accessory security, also referred to as "Restricted Mode", is a feature in macOS that aims to safeguard users against potential close-range assaults using wired devices. On Macs running macOS 13 or a newer version, the default setting prompts the user to grant permission for new accessories. There are four available choices in System Settings for granting permission to attach accessories:</p><ul><li>Ask every time</li><li>Ask for new accessories</li><li>Automatically when unlocked</li><li>Always</li></ul><p>Using Microsoft Intune, you can control this setting by using <code>allowUSBRestrictedMode</code>&nbsp;restriction.</p><h3 id="mdm-management-of-host-pairing"><strong>MDM Management of Host Pairing</strong></h3><p>For supervised iPhones and iPads,&nbsp;administrators wield the power to control USB pairing with a critical MDM restriction:&nbsp;"Allow pairing with non-Apple Configurator hosts." This restriction acts as a gatekeeper,&nbsp;granting access only to trusted computers armed with valid supervision host certificates.</p><p><em><u>Think of it this way</u></em>:&nbsp;activating the restriction empowers device management,&nbsp;while distributing correct supervision identities provides unique security keys.&nbsp;Only computers presenting the "correct password" - the valid certificate - gain entry.&nbsp;No certificate?&nbsp;The door remains firmly locked,&nbsp;barring unauthorized connections.</p><p>This approach bolsters security by limiting access to authorized devices,&nbsp;ensuring your organization's valuable data stays shielded.&nbsp;Imagine the peace of mind knowing exactly which computers can interact with your corporate information!Plus,&nbsp;it simplifies management through centralized control within your MDM solution.</p><p>Remember,&nbsp;this restriction complements Apple Configurator certificates,&nbsp;not replacing them.&nbsp;Think of it as adding another layer of defense.&nbsp;By implementing this powerful feature,&nbsp;you create a secure haven where only approved computers can connect,&nbsp;safeguarding your data and empowering control over device interactions.</p><h3 id="enrolment-profile-in-intune-and-connection-error"><strong>Enrolment Profile in Intune and Connection Error</strong></h3><p>The enrolment profile was configured as per documentation</p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2024/02/image-3.png" class="kg-image" alt="" loading="lazy" width="1668" height="446" srcset="__GHOST_URL__/content/images/size/w600/2024/02/image-3.png 600w, __GHOST_URL__/content/images/size/w1000/2024/02/image-3.png 1000w, __GHOST_URL__/content/images/size/w1600/2024/02/image-3.png 1600w, __GHOST_URL__/content/images/2024/02/image-3.png 1668w" sizes="(min-width: 720px) 720px"></figure><p>When trying to connect the phone, the finder gave the below error:</p><p></p><p>and, there were was no restriction in any other profile in Intune to block this.</p><p><strong>I was going crazy, if everything was configured correctly, why the sudden connection chaos?</strong> </p><h3 id="unveiling-the-culprit"><strong>Unveiling the Culprit</strong></h3><p>Hitting a dead end felt like slamming into a brick wall. The only way forward? Hunt down the mysterious payload controlling this stubborn restriction. Sifting through error logs and Apple MDM docs, I stumbled upon a shocking truth: the "allow_pairing" setting had vanished with iOS 13 and iPadOS 13.1! It was supposed to be gone, a relic of the past. So, why in the world was it causing havoc in iOS 17 and Sonoma? If it was retired years ago, why was it suddenly causing issues in iOS 17 and Sonoma? This head-scratcher was still the mystery.</p><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2024/02/image-4.png" class="kg-image" alt="" loading="lazy" width="1828" height="240" srcset="__GHOST_URL__/content/images/size/w600/2024/02/image-4.png 600w, __GHOST_URL__/content/images/size/w1000/2024/02/image-4.png 1000w, __GHOST_URL__/content/images/size/w1600/2024/02/image-4.png 1600w, __GHOST_URL__/content/images/2024/02/image-4.png 1828w" sizes="(min-width: 720px) 720px"></figure><p>Any pairing restrictions imposed at enrollment are irreversible and cannot be changed dynamically. Re-enrolling with the proper settings after erasing is your only choice. In that scenario, creating an iCloud backup is a legitimate data preservation method.</p><h2 id="unpleasant-truth-a-fix-with-a-sting-but-security-wins">Unpleasant Truth: A Fix with a Sting (But Security Wins)</h2><p>Alright, let's be honest: this solution isn't going to win you any popularity contests. Developers and users alike might raise an eyebrow (or two). But here's the deal: it's the only way out of this particular tech maze.</p><p>Ready? Here's the plan:</p><ol><li><strong>First things first:</strong>&nbsp;Remove the "blocking sync" setting from your enrollment profile. Think of it like taking down a security barrier.</li><li><strong>Wipe and re-enroll:</strong>&nbsp;Yes, you read that right. It's a clean slate moment for your devices. Data backups are your friend here, so make sure they're in place.</li><li><strong>Push the restriction:</strong>&nbsp;Once the devices are back in the game, use your Intune setting catalog to push the restriction again. This time, it should stick!</li></ol><figure class="kg-card kg-image-card"><img src="__GHOST_URL__/content/images/2024/02/IMG_6345.jpeg" class="kg-image" alt="" loading="lazy" width="1290" height="1750" srcset="__GHOST_URL__/content/images/size/w600/2024/02/IMG_6345.jpeg 600w, __GHOST_URL__/content/images/size/w1000/2024/02/IMG_6345.jpeg 1000w, __GHOST_URL__/content/images/2024/02/IMG_6345.jpeg 1290w" sizes="(min-width: 720px) 720px"></figure><p>Remember, security sometimes requires tough choices. This fix might not be the smoothest ride, but it ensures your data remains protected.</p><p><strong>Bonus tip:</strong>&nbsp;Consider communicating this change clearly to your users and developers beforehand. Transparency goes a long way in building trust, even when the solution isn't ideal.</p><h2 id="the-hunt-continues-securing-our-mdm-kingdom-one-setting-at-a-time">The Hunt Continues: Securing Our MDM Kingdom, One Setting at a Time</h2><p>So, there you have it! Rest assured, with the "block pairing" restriction back in place, you regain control over device connections. You can grant access gradually, adhering to your organization's security guidelines, ensuring only authorized users and devices gain entry.</p><p>Remember, the "why" behind the sudden malfunction remains a mystery. But hey, that's just another challenge in the exciting world of IT! This "hunt " has served as a valuable lesson, reminding us to stay vigilant and adapt to unexpected changes.</p><p><strong>Until next time! May your endpoints be secure and your troubleshooting swift.</strong></p><p></p><p><br></p>